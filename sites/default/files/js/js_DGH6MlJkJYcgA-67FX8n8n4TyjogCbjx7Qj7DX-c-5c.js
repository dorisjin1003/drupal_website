/**
 * @file
 * CKEditor 5 premium features override of CKEditor 5 implementation
 * of {@link Drupal.editors} API.
 *
 * Prevents executing original detach on tabledrag and ensures there is no
 * editor already initialized before attaching new one.
 */

((Drupal) => {

  Drupal.editors.ckeditor5.coreAttach = Drupal.editors.ckeditor5.attach;
  Drupal.editors.ckeditor5.coreDetach = Drupal.editors.ckeditor5.detach;

  Drupal.editors.ckeditor5.attach = function(element, format) {
    const id = element.getAttribute('data-ckeditor5-id');
    const editor = Drupal.CKEditor5Instances.get(id);
    // Init new editor only if we don't yet have it on element.
    if (!editor) {
      Drupal.editors.ckeditor5.coreAttach(element, format);
    }
  }

  Drupal.editors.ckeditor5.detach = function(element, format, trigger) {
    if (trigger !== 'move') {
      Drupal.editors.ckeditor5.coreDetach(element, format, trigger);
    }
  }

})(Drupal);
;
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.sidebarAdapter=t())}(self,(()=>(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>s});const i=class{constructor(e){this.editor=e,this.elementId=this.editor.sourceElement.dataset.ckeditor5PremiumElementId}processCollaborationCommandDisable(e){if(!this.isCollaborationDisabled())return!1;const t=this.editor.commands._commands.get(e);return void 0===t||t.forceDisabled("premium-features-module"),!0}processRevisionDisable(){return!!this.isCollaborationDisabled()&&(this.editor.plugins.has("RevisionTracker")&&(this.editor.plugins.get("RevisionTracker").isEnabled=!1),!0)}isCollaborationDisabled(){return void 0!==drupalSettings.ckeditor5Premium&&void 0!==drupalSettings.ckeditor5Premium.disableCollaboration&&!0===drupalSettings.ckeditor5Premium.disableCollaboration}getEditorParentContainer(e){let t=document.getElementById(e);for(;t&&void 0!==t&&void 0!==t.classList&&!t.classList.contains("ck-editor-sidebar-wrapper");)t=t.parentElement;return t&&void 0!==t?t.parentElement:null}getSourceDataSelector(e){return{trackChanges:".track-changes",comments:".comments",revisionHistory:".revision-history",revisionHistoryContainer:".revision-history-container",resolvedSuggestionsComments:".resolved-suggestions-comments"}[e]+"-data"+`[data-ckeditor5-premium-element-id="${this.elementId}"]`}};const s={SidebarAdapter:class{constructor(e){this.editor=e,this.storage=new i(e),this.toolbar=this.editor.ui._toolbarConfig.items,this.sidebarMode=drupalSettings.ckeditor5SidebarMode??"auto",this.resizeThreshold=0;let t=this.getSidebarWrapper(this.editor.sourceElement.id);void 0!==t&&t&&(this.sidebarColumn=t,this.sidebar=t.parentElement,this.editor.config._config.sidebar={container:t})}static get pluginName(){return"SidebarAdapter"}sidebarVisibilityModify(e=!1){this.sidebar&&void 0!==this.sidebar&&this.sidebar.classList.toggle("slider-off",e)}init(){if(!this.sidebar||!this.editor.plugins.has("AnnotationsUIs"))return;this.annotationsUIs=this.editor.plugins.get("AnnotationsUIs");let e=document.createElement("div");e.classList.add("ck-sidebar-auto-toggle-wrapper");let t=document.createElement("a");t.classList+="ck-sidebar-auto-toggle "+this.sidebarMode,t.id="ck-sidebar-auto-toggle",e.prepend(t),this.sidebarColumn.prepend(e)}afterInit(){if(!this.annotationsUIs||void 0===this.annotationsUIs||!this.sidebar||void 0===this.sidebar)return;let e=!this.toolbar.includes("trackChanges")&&!this.toolbar.includes("comment")||this.storage.isCollaborationDisabled();this.sidebarVisibilityModify(e),this.handleSidebarMode(),this.checkIfInsideTab()}destroy(){this.sidebarVisibilityModify(!0);let e=this.getSidebarToggle();e&&e.remove()}getSidebarWrapper(e){let t=this.storage.getEditorParentContainer(e);return t?t.querySelector(".ck-sidebar-wrapper"):null}handleSidebarMode(){let e=this.getSidebarToggle();if("auto"!==this.sidebarMode)return this.setCkEditorSidebarMode(this.sidebarMode),void(e&&(e.style.display="none"));this.updateCkeditorMode(),this.checkEditorLabel(),e&&(window.addEventListener("resize",(()=>{clearTimeout(this.resizeThreshold),this.resizeThreshold=setTimeout((()=>{this.updateCkeditorMode()}),100)})),e.addEventListener("click",(()=>{this.sidebar.classList.contains("narrowSidebar")?(this.sidebar.classList.remove("manual-toggled"),this.setCkEditorSidebarMode("wideSidebar")):(this.setCkEditorSidebarMode("narrowSidebar"),this.sidebar.classList.add("manual-toggled"))})))}getSidebarToggle(){return this.sidebar&&void 0!==this.sidebar?this.sidebar.querySelector(".ck-sidebar-auto-toggle-wrapper"):null}setCkEditorSidebarMode(e){this.sidebar&&void 0!==this.sidebar&&(this.sidebar.classList.contains("manual-toggled")&&"wideSidebar"===e||(this.sidebar.classList.remove("inline","narrowSidebar","wideSidebar"),this.annotationsUIs.switchTo(e),this.sidebar.classList.add(e)))}updateCkeditorMode=function(){let e=document.documentElement.clientWidth,t=e>=1200?"wideSidebar":e>=500?"narrowSidebar":"inline";this.sidebar.clientWidth<720&&(t=this.sidebar.clientWidth>=500?"narrowSidebar":"inline"),this.setCkEditorSidebarMode(t)};checkEditorLabel(){let e=this.sidebar.querySelector("label");e&&void 0!==e&&!e.classList.contains("visually-hidden")&&(this.sidebarColumn.style.marginTop=e.clientHeight+"px")}checkIfInsideTab(){const e=this.sidebar.closest(".field-group-tab");e&&void 0!==e&&this.checkParentTabs(e)}checkParentTabs(e){const t=e.parentElement.closest(".field-group-tab");t&&void 0!==t&&e!==t&&(!t.open||"none"===t.style.display||t.classList.contains("horizontal-tab-hidden")?this.setObserverToElement(t):this.checkParentTabs(t)),e.open&&!e.classList.contains("horizontal-tab-hidden")||this.setObserverToElement(e)}setObserverToElement(e){this.setObserver(e).then((()=>{this.updateCkeditorMode(),this.checkEditorLabel()}))}setObserver(e){return new Promise((t=>{const i=new MutationObserver((s=>{e.open&&"none"!==e.style.display&&!e.classList.contains("horizontal-tab-hidden")&&(t(),i.disconnect())}));i.observe(document.body,{childList:!0,subtree:!0})}))}}};return t=t.default})()));;
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.disableCollaborationMarkersInCaption=t())}(self,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var a in o)e.o(o,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:o[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>o});const o={DisableCollaborationMarkersInCaption:class{constructor(e){this.editor=e}afterInit(){const e=this.editor,t=e.commands.get("addCommentThread"),o=e.commands.get("trackChanges");if(e.set("disabledCommands",!1),!e.plugins.has("DrupalImage")||!e.plugins.has("TrackChangesEditing"))return;{const t=e.plugins.get("TrackChangesEditing");try{t.enableCommand("toggleImageCaption",((e,t)=>{e(t)}),{priority:"high"})}catch(e){return}}let a;e.model.document.on("change",(()=>{e.disabledCommands||(a=o.value)}),{priority:"highest"}),e.model.document.on("change",(()=>{"caption"==e.model.document.selection.getFirstRange().getCommonAncestor().name?(t.forceDisabled("drupal-premium-features"),o.forceDisabled("drupal-premium-features"),o.value=!1,e.set("disabledCommands",!0)):e.disabledCommands&&(t.clearForceDisabled("drupal-premium-features"),o.clearForceDisabled("drupal-premium-features"),e.set("disabledCommands",!1),a&&(o.value=!0))}),{priority:"low"})}}};return t=t.default})()));;
!function(e,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?exports.CKEditor5=o():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.removeIncorrectCollaborationMarkers=o())}(self,(()=>(()=>{"use strict";var e={d:(o,t)=>{for(var r in t)e.o(t,r)&&!e.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:t[r]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)},o={};e.d(o,{default:()=>t});const t={RemoveIncorrectCollaborationMarkers:class{constructor(e){this.editor=e}afterInit(){this.editor.model.document.once("change:data",(()=>{const e=this.editor.plugins.has("TrackChanges"),o=this.editor.plugins.has("CommentsRepository"),t=Array.from(this.editor.model.document.differ.getChangedMarkers()),r=t.filter((e=>e.name.includes("suggestion"))),i=t.filter((e=>e.name.includes("comment")));if(e){const e=this.editor.plugins.get("TrackChanges");for(const o of r){const{name:t}=o,r=t.split(":"),i=r.length<5?r[2]:r[3];e.getSuggestions().some((e=>e.id==i))||this._removeSuggestionMarker(i)}}if(o){const e=this.editor.plugins.get("CommentsRepository");for(const o of i){const{name:t}=o,r=t.split(":")[1];e.getCommentThreads().some((e=>e.id==r))||this._removeCommentMarker(r)}}}),{priority:"high"})}_removeSuggestionMarker(e){const o=this.editor.model.markers.getMarkersGroup("suggestion"),t=Array.from(o).filter((o=>o.name.includes(e)));this.editor.model.change((e=>{e.removeMarker(...t)}),{priority:"high"})}_removeCommentMarker(e){const o=this.editor.model.markers.getMarkersGroup("comment"),t=Array.from(o).filter((o=>o.name.includes(e)));this.editor.model.change((e=>{e.removeMarker(...t)}))}}};return o=o.default})()));;
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.commentsAdapter=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/engine.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/engine.js")},"ckeditor5/src/enter.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/enter.js")},"ckeditor5/src/typing.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/typing.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";i.d(n,{default:()=>Z});var e=i("ckeditor5/src/core.js"),t=i("ckeditor5/src/typing.js"),o=i("ckeditor5/src/engine.js"),s=i("ckeditor5/src/utils.js");function r(e,t,i,n){let r,l=null;"function"==typeof n?r=n:(l=e.commands.get(n),r=()=>{e.execute(n)}),e.model.document.on("change:data",((a,c)=>{if(l&&!l.isEnabled||!t.isEnabled)return;const d=(0,s.first)(e.model.document.selection.getRanges());if(!d.isCollapsed)return;if(c.isUndo||!c.isLocal)return;const u=Array.from(e.model.document.differ.getChanges()),m=u[0];if(1!=u.length||"insert"!==m.type||"$text"!=m.name||1!=m.length)return;const g=m.position.parent;if(g.is("element","codeBlock"))return;if(g.is("element","listItem")&&"function"!=typeof n&&!["numberedList","bulletedList","todoList"].includes(n))return;if(l&&!0===l.value)return;const f=g.getChild(0),h=e.model.createRangeOn(f);if(!h.containsRange(d)&&!d.end.isEqual(h.end))return;const p=i.exec(f.data.substr(0,d.end.offset));p&&e.model.enqueueChange((t=>{const i=t.createPositionAt(g,0),n=t.createPositionAt(g,p[0].length),s=new o.LiveRange(i,n);if(!1!==r({match:p})){t.remove(s);const i=e.model.document.selection.getFirstRange(),n=t.createRangeIn(g);!g.isEmpty||n.isEqual(i)||n.containsRange(i,!0)||t.remove(g)}s.detach(),e.model.enqueueChange((()=>{e.plugins.get("Delete").requestUndoOnBackspace()}))}))}))}function l(e,t,i,n){let o,s;i instanceof RegExp?o=i:s=i,s=s||(e=>{let t;const i=[],n=[];for(;null!==(t=o.exec(e))&&!(t&&t.length<4);){let{index:e,1:o,2:s,3:r}=t;const l=o+s+r;e+=t[0].length-l.length;const a=[e,e+o.length],c=[e+o.length+s.length,e+o.length+s.length+r.length];i.push(a),i.push(c),n.push([e+o.length,e+o.length+s.length])}return{remove:i,format:n}}),e.model.document.on("change:data",((i,o)=>{if(o.isUndo||!o.isLocal||!t.isEnabled)return;const r=e.model,l=r.document.selection;if(!l.isCollapsed)return;const c=Array.from(r.document.differ.getChanges()),d=c[0];if(1!=c.length||"insert"!==d.type||"$text"!=d.name||1!=d.length)return;const u=l.focus,m=u.parent,{text:g,range:f}=function(e,t){let i=e.start;return{text:Array.from(e.getItems()).reduce(((e,n)=>!n.is("$text")&&!n.is("$textProxy")||n.getAttribute("code")?(i=t.createPositionAfter(n),""):e+n.data),""),range:t.createRange(i,e.end)}}(r.createRange(r.createPositionAt(m,0),u),r),h=s(g),p=a(f.start,h.format,r),b=a(f.start,h.remove,r);p.length&&b.length&&r.enqueueChange((t=>{if(!1!==n(t,p)){for(const e of b.reverse())t.remove(e);r.enqueueChange((()=>{e.plugins.get("Delete").requestUndoOnBackspace()}))}}))}))}function a(e,t,i){return t.filter((e=>void 0!==e[0]&&void 0!==e[1])).map((t=>i.createRange(e.getShiftedBy(t[0]),e.getShiftedBy(t[1]))))}class c extends e.Plugin{static get requires(){return[t.Delete]}static get pluginName(){return"Autoformat"}afterInit(){this._addListAutoformats(),this._addBasicStylesAutoformats(),this._addHeadingAutoformats(),this._addBlockQuoteAutoformats(),this._addCodeBlockAutoformats(),this._addHorizontalLineAutoformats()}_addListAutoformats(){const e=this.editor.commands;e.get("bulletedList")&&r(this.editor,this,/^[*-]\s$/,"bulletedList"),e.get("numberedList")&&r(this.editor,this,/^1[.|)]\s$/,"numberedList"),e.get("todoList")&&r(this.editor,this,/^\[\s?\]\s$/,"todoList"),e.get("checkTodoList")&&r(this.editor,this,/^\[\s?x\s?\]\s$/,(()=>{this.editor.execute("todoList"),this.editor.execute("checkTodoList")}))}_addBasicStylesAutoformats(){const e=this.editor.commands;if(e.get("bold")){const e=d(this.editor,"bold");l(this.editor,this,/(?:^|\s)(\*\*)([^*]+)(\*\*)$/g,e),l(this.editor,this,/(?:^|\s)(__)([^_]+)(__)$/g,e)}if(e.get("italic")){const e=d(this.editor,"italic");l(this.editor,this,/(?:^|\s)(\*)([^*_]+)(\*)$/g,e),l(this.editor,this,/(?:^|\s)(_)([^_]+)(_)$/g,e)}if(e.get("code")){const e=d(this.editor,"code");l(this.editor,this,/(`)([^`]+)(`)$/g,e)}if(e.get("strikethrough")){const e=d(this.editor,"strikethrough");l(this.editor,this,/(~~)([^~]+)(~~)$/g,e)}}_addHeadingAutoformats(){const e=this.editor.commands.get("heading");e&&e.modelElements.filter((e=>e.match(/^heading[1-6]$/))).forEach((t=>{const i=t[7],n=new RegExp(`^(#{${i}})\\s$`);r(this.editor,this,n,(()=>{if(!e.isEnabled||e.value===t)return!1;this.editor.execute("heading",{value:t})}))}))}_addBlockQuoteAutoformats(){this.editor.commands.get("blockQuote")&&r(this.editor,this,/^>\s$/,"blockQuote")}_addCodeBlockAutoformats(){const e=this.editor,t=e.model.document.selection;e.commands.get("codeBlock")&&r(e,this,/^```$/,(()=>{if(t.getFirstPosition().parent.is("element","listItem"))return!1;this.editor.execute("codeBlock",{usePreviousLanguageChoice:!0})}))}_addHorizontalLineAutoformats(){this.editor.commands.get("horizontalLine")&&r(this.editor,this,/^---$/,"horizontalLine")}}function d(e,t){return(i,n)=>{if(!e.commands.get(t).isEnabled)return!1;const o=e.model.schema.getValidRanges(n,t);for(const e of o)i.setAttribute(t,!0,e);i.removeSelectionAttribute(t)}}class u extends e.Command{constructor(e,t){super(e),this.attributeKey=t}refresh(){const e=this.editor.model,t=e.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=e.schema.checkAttributeInSelection(t.selection,this.attributeKey)}execute(e={}){const t=this.editor.model,i=t.document.selection,n=void 0===e.forceValue?!this.value:e.forceValue;t.change((e=>{if(i.isCollapsed)n?e.setSelectionAttribute(this.attributeKey,!0):e.removeSelectionAttribute(this.attributeKey);else{const o=t.schema.getValidRanges(i.getRanges(),this.attributeKey);for(const t of o)n?e.setAttribute(this.attributeKey,n,t):e.removeAttribute(this.attributeKey,t)}}))}_getValueFromFirstAllowedNode(){const e=this.editor.model,t=e.schema,i=e.document.selection;if(i.isCollapsed)return i.hasAttribute(this.attributeKey);for(const e of i.getRanges())for(const i of e.getItems())if(t.checkAttribute(i,this.attributeKey))return i.hasAttribute(this.attributeKey);return!1}}const m="bold";class g extends e.Plugin{static get pluginName(){return"BoldEditing"}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:m}),e.model.schema.setAttributeProperties(m,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:m,view:"strong",upcastAlso:["b",e=>{const t=e.getStyle("font-weight");return t?"bold"==t||Number(t)>=600?{name:!0,styles:["font-weight"]}:void 0:null}]}),e.commands.add(m,new u(e,m)),e.keystrokes.set("CTRL+B",m)}}var f=i("ckeditor5/src/ui.js");const h="bold";class p extends e.Plugin{static get pluginName(){return"BoldUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(h,(i=>{const n=e.commands.get(h),o=new f.ButtonView(i);return o.set({label:t("Bold"),icon:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.187 17H5.773c-.637 0-1.092-.138-1.364-.415-.273-.277-.409-.718-.409-1.323V4.738c0-.617.14-1.062.419-1.332.279-.27.73-.406 1.354-.406h4.68c.69 0 1.288.041 1.793.124.506.083.96.242 1.36.478.341.197.644.447.906.75a3.262 3.262 0 0 1 .808 2.162c0 1.401-.722 2.426-2.167 3.075C15.05 10.175 16 11.315 16 13.01a3.756 3.756 0 0 1-2.296 3.504 6.1 6.1 0 0 1-1.517.377c-.571.073-1.238.11-2 .11zm-.217-6.217H7v4.087h3.069c1.977 0 2.965-.69 2.965-2.072 0-.707-.256-1.22-.768-1.537-.512-.319-1.277-.478-2.296-.478zM7 5.13v3.619h2.606c.729 0 1.292-.067 1.69-.2a1.6 1.6 0 0 0 .91-.765c.165-.267.247-.566.247-.897 0-.707-.26-1.176-.778-1.409-.519-.232-1.31-.348-2.375-.348H7z"/></svg>',keystroke:"CTRL+B",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(n,"value","isEnabled"),this.listenTo(o,"execute",(()=>{e.execute(h),e.editing.view.focus()})),o}))}}class b extends e.Plugin{static get requires(){return[g,p]}static get pluginName(){return"Bold"}}const v="italic";class I extends e.Plugin{static get pluginName(){return"ItalicEditing"}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:v}),e.model.schema.setAttributeProperties(v,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:v,view:"i",upcastAlso:["em",{styles:{"font-style":"italic"}}]}),e.commands.add(v,new u(e,v)),e.keystrokes.set("CTRL+I",v)}}const A="italic";class y extends e.Plugin{static get pluginName(){return"ItalicUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(A,(i=>{const n=e.commands.get(A),o=new f.ButtonView(i);return o.set({label:t("Italic"),icon:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.586 14.633.021.004c-.036.335.095.655.393.962.082.083.173.15.274.201h1.474a.6.6 0 1 1 0 1.2H5.304a.6.6 0 0 1 0-1.2h1.15c.474-.07.809-.182 1.005-.334.157-.122.291-.32.404-.597l2.416-9.55a1.053 1.053 0 0 0-.281-.823 1.12 1.12 0 0 0-.442-.296H8.15a.6.6 0 0 1 0-1.2h6.443a.6.6 0 1 1 0 1.2h-1.195c-.376.056-.65.155-.823.296-.215.175-.423.439-.623.79l-2.366 9.347z"/></svg>',keystroke:"CTRL+I",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(n,"value","isEnabled"),this.listenTo(o,"execute",(()=>{e.execute(A),e.editing.view.focus()})),o}))}}class w extends e.Plugin{static get requires(){return[I,y]}static get pluginName(){return"Italic"}}class C extends e.Command{constructor(e,t){super(e),this.type=t}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const t=this.editor.model,i=t.document,n=Array.from(i.selection.getSelectedBlocks()).filter((e=>P(e,t.schema))),o=void 0!==e.forceValue?!e.forceValue:this.value;t.change((e=>{if(o){let t=n[n.length-1].nextSibling,i=Number.POSITIVE_INFINITY,o=[];for(;t&&"listItem"==t.name&&0!==t.getAttribute("listIndent");){const e=t.getAttribute("listIndent");e<i&&(i=e);const n=e-i;o.push({element:t,listIndent:n}),t=t.nextSibling}o=o.reverse();for(const t of o)e.setAttribute("listIndent",t.listIndent,t.element)}if(!o){let e=Number.POSITIVE_INFINITY;for(const t of n)t.is("element","listItem")&&t.getAttribute("listIndent")<e&&(e=t.getAttribute("listIndent"));e=0===e?1:e,x(n,!0,e),x(n,!1,e)}for(const t of n.reverse())o&&"listItem"==t.name?e.rename(t,"paragraph"):o||"listItem"==t.name?o||"listItem"!=t.name||t.getAttribute("listType")==this.type||e.setAttribute("listType",this.type,t):(e.setAttributes({listType:this.type,listIndent:0},t),e.rename(t,"listItem"));this.fire("_executeCleanup",n)}))}_getValue(){const e=(0,s.first)(this.editor.model.document.selection.getSelectedBlocks());return!!e&&e.is("element","listItem")&&e.getAttribute("listType")==this.type}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,t=this.editor.model.schema,i=(0,s.first)(e.getSelectedBlocks());return!!i&&P(i,t)}}function x(e,t,i){const n=t?e[0]:e[e.length-1];if(n.is("element","listItem")){let o=n[t?"previousSibling":"nextSibling"],s=n.getAttribute("listIndent");for(;o&&o.is("element","listItem")&&o.getAttribute("listIndent")>=i;)s>o.getAttribute("listIndent")&&(s=o.getAttribute("listIndent")),o.getAttribute("listIndent")==s&&e[t?"unshift":"push"](o),o=o[t?"previousSibling":"nextSibling"]}}function P(e,t){return t.checkChild(e.parent,"listItem")&&!t.isObject(e)}class E extends e.Command{constructor(e,t){super(e),this._indentBy="forward"==t?1:-1}refresh(){this.isEnabled=this._checkEnabled()}execute(){const e=this.editor.model,t=e.document;let i=Array.from(t.selection.getSelectedBlocks());e.change((e=>{const t=i[i.length-1];let n=t.nextSibling;for(;n&&"listItem"==n.name&&n.getAttribute("listIndent")>t.getAttribute("listIndent");)i.push(n),n=n.nextSibling;this._indentBy<0&&(i=i.reverse());for(const t of i){const i=t.getAttribute("listIndent")+this._indentBy;i<0?e.rename(t,"paragraph"):e.setAttribute("listIndent",i,t)}this.fire("_executeCleanup",i)}))}_checkEnabled(){const e=(0,s.first)(this.editor.model.document.selection.getSelectedBlocks());if(!e||!e.is("element","listItem"))return!1;if(this._indentBy>0){const t=e.getAttribute("listIndent"),i=e.getAttribute("listType");let n=e.previousSibling;for(;n&&n.is("element","listItem")&&n.getAttribute("listIndent")>=t;){if(n.getAttribute("listIndent")==t)return n.getAttribute("listType")==i;n=n.previousSibling}return!1}return!0}}var k=i("ckeditor5/src/enter.js");function S(e,t){const i=t.mapper,n=t.writer,o="numbered"==e.getAttribute("listType")?"ol":"ul",s=function(e){const t=e.createContainerElement("li");return t.getFillerOffset=V,t}(n),r=n.createContainerElement(o,null);return n.insert(n.createPositionAt(r,0),s),i.bindElements(e,s),s}function B(e,t,i,n){const o=t.parent,s=i.mapper,r=i.writer;let l=s.toViewPosition(n.createPositionBefore(e));const a=_(e.previousSibling,{sameIndent:!0,smallerIndent:!0,listIndent:e.getAttribute("listIndent")}),c=e.previousSibling;if(a&&a.getAttribute("listIndent")==e.getAttribute("listIndent")){const e=s.toViewElement(a);l=r.breakContainer(r.createPositionAfter(e))}else if(c&&"listItem"==c.name){l=s.toViewPosition(n.createPositionAt(c,"end"));const e=s.findMappedViewAncestor(l),t=function(e){for(const t of e.getChildren())if("ul"==t.name||"ol"==t.name)return t;return null}(e);l=t?r.createPositionBefore(t):r.createPositionAt(e,"end")}else l=s.toViewPosition(n.createPositionBefore(e));if(l=T(l),r.insert(l,o),c&&"listItem"==c.name){const e=s.toViewElement(c),i=r.createRange(r.createPositionAt(e,0),l).getWalker({ignoreElementEnd:!0});for(const e of i)if(e.item.is("element","li")){const n=r.breakContainer(r.createPositionBefore(e.item)),o=e.item.parent,s=r.createPositionAt(t,"end");L(r,s.nodeBefore,s.nodeAfter),r.move(r.createRangeOn(o),s),i.position=n}}else{const i=o.nextSibling;if(i&&(i.is("element","ul")||i.is("element","ol"))){let n=null;for(const t of i.getChildren()){const i=s.toModelElement(t);if(!(i&&i.getAttribute("listIndent")>e.getAttribute("listIndent")))break;n=t}n&&(r.breakContainer(r.createPositionAfter(n)),r.move(r.createRangeOn(n.parent),r.createPositionAt(t,"end")))}}L(r,o,o.nextSibling),L(r,o.previousSibling,o)}function L(e,t,i){return!t||!i||"ul"!=t.name&&"ol"!=t.name||t.name!=i.name||t.getAttribute("class")!==i.getAttribute("class")?null:e.mergeContainers(e.createPositionAfter(t))}function T(e){return e.getLastMatchingPosition((e=>e.item.is("uiElement")))}function _(e,t){const i=!!t.sameIndent,n=!!t.smallerIndent,o=t.listIndent;let s=e;for(;s&&"listItem"==s.name;){const e=s.getAttribute("listIndent");if(i&&o==e||n&&o>e)return s;s="forward"===t.direction?s.nextSibling:s.previousSibling}return null}function R(e,t,i,n){e.ui.componentFactory.add(t,(o=>{const s=e.commands.get(t),r=new f.ButtonView(o);return r.set({label:i,icon:n,tooltip:!0,isToggleable:!0}),r.bind("isOn","isEnabled").to(s,"value","isEnabled"),r.on("execute",(()=>{e.execute(t),e.editing.view.focus()})),r}))}function V(){const e=!this.isEmpty&&("ul"==this.getChild(0).name||"ol"==this.getChild(0).name);return this.isEmpty||e?0:o.getFillerOffset.call(this)}function N(e){return(t,i,n)=>{const o=n.consumable;if(!o.test(i.item,"insert")||!o.test(i.item,"attribute:listType")||!o.test(i.item,"attribute:listIndent"))return;o.consume(i.item,"insert"),o.consume(i.item,"attribute:listType"),o.consume(i.item,"attribute:listIndent");const s=i.item;B(s,S(s,n),n,e)}}function K(e,t,i){if(!i.consumable.test(t.item,e.name))return;const n=i.mapper.toViewElement(t.item),o=i.writer;o.breakContainer(o.createPositionBefore(n)),o.breakContainer(o.createPositionAfter(n));const s=n.parent,r="numbered"==t.attributeNewValue?"ol":"ul";o.rename(r,s)}function O(e,t,i){i.consumable.consume(t.item,e.name);const n=i.mapper.toViewElement(t.item).parent,o=i.writer;L(o,n,n.nextSibling),L(o,n.previousSibling,n)}function $(e,t,i){if(i.consumable.test(t.item,e.name)&&"listItem"!=t.item.name){let e=i.mapper.toViewPosition(t.range.start);const n=i.writer,o=[];for(;("ul"==e.parent.name||"ol"==e.parent.name)&&(e=n.breakContainer(e),"li"==e.parent.name);){const t=e,i=n.createPositionAt(e.parent,"end");if(!t.isEqual(i)){const e=n.remove(n.createRange(t,i));o.push(e)}e=n.createPositionAfter(e.parent)}if(o.length>0){for(let t=0;t<o.length;t++){const i=e.nodeBefore;if(e=n.insert(e,o[t]).end,t>0){const t=L(n,i,i.nextSibling);t&&t.parent==i&&e.offset--}}L(n,e.nodeBefore,e.nodeAfter)}}}function j(e,t,i){const n=i.mapper.toViewPosition(t.position),o=n.nodeBefore,s=n.nodeAfter;L(i.writer,o,s)}function M(e,t,i){if(i.consumable.consume(t.viewItem,{name:!0})){const e=i.writer,n=e.createElement("listItem"),o=function(e){let t=0,i=e.parent;for(;i;){if(i.is("element","li"))t++;else{const e=i.previousSibling;e&&e.is("element","li")&&t++}i=i.parent}return t}(t.viewItem);e.setAttribute("listIndent",o,n);const s=t.viewItem.parent&&"ol"==t.viewItem.parent.name?"numbered":"bulleted";if(e.setAttribute("listType",s,n),!i.safeInsert(n,t.modelCursor))return;const r=function(e,t,i){const{writer:n,schema:o}=i;let s=n.createPositionAfter(e);for(const r of t)if("ul"==r.name||"ol"==r.name)s=i.convertItem(r,s).modelCursor;else{const t=i.convertItem(r,n.createPositionAt(e,"end")),l=t.modelRange.start.nodeAfter;l&&l.is("element")&&!o.checkChild(e,l.name)&&(e=t.modelCursor.parent.is("element","listItem")?t.modelCursor.parent:H(t.modelCursor),s=n.createPositionAfter(e))}return s}(n,t.viewItem.getChildren(),i);t.modelRange=e.createRange(t.modelCursor,r),i.updateConversionResult(n,t)}}function F(e,t,i){if(i.consumable.test(t.viewItem,{name:!0})){const e=Array.from(t.viewItem.getChildren());for(const t of e){!(t.is("element","li")||Q(t))&&t._remove()}}}function D(e,t,i){if(i.consumable.test(t.viewItem,{name:!0})){if(0===t.viewItem.childCount)return;const e=[...t.viewItem.getChildren()];let i=!1;for(const t of e)i&&!Q(t)&&t._remove(),Q(t)&&(i=!0)}}function q(e){return(t,i)=>{if(i.isPhantom)return;const n=i.modelPosition.nodeBefore;if(n&&n.is("element","listItem")){const t=i.mapper.toViewElement(n),o=t.getAncestors().find(Q),s=e.createPositionAt(t,0).getWalker();for(const e of s){if("elementStart"==e.type&&e.item.is("element","li")){i.viewPosition=e.previousPosition;break}if("elementEnd"==e.type&&e.item==o){i.viewPosition=e.nextPosition;break}}}}}function z(e,[t,i]){let n,o=t.is("documentFragment")?t.getChild(0):t;if(n=i?this.createSelection(i):this.document.selection,o&&o.is("element","listItem")){const e=n.getFirstPosition();let t=null;if(e.parent.is("element","listItem")?t=e.parent:e.nodeBefore&&e.nodeBefore.is("element","listItem")&&(t=e.nodeBefore),t){const e=t.getAttribute("listIndent");if(e>0)for(;o&&o.is("element","listItem");)o._setAttribute("listIndent",o.getAttribute("listIndent")+e),o=o.nextSibling}}}function H(e){const t=new o.TreeWalker({startPosition:e});let i;do{i=t.next()}while(!i.value.item.is("element","listItem"));return i.value.item}function U(e,t,i,n,o,s){const r=_(t.nodeBefore,{sameIndent:!0,smallerIndent:!0,listIndent:e,foo:"b"}),l=o.mapper,a=o.writer,c=r?r.getAttribute("listIndent"):null;let d;if(r)if(c==e){const e=l.toViewElement(r).parent;d=a.createPositionAfter(e)}else{const e=s.createPositionAt(r,"end");d=l.toViewPosition(e)}else d=i;d=T(d);for(const e of[...n.getChildren()])Q(e)&&(d=a.move(a.createRangeOn(e),d).end,L(a,e,e.nextSibling),L(a,e.previousSibling,e))}function Q(e){return e.is("element","ol")||e.is("element","ul")}class J extends e.Plugin{static get pluginName(){return"ListEditing"}static get requires(){return[k.Enter,t.Delete]}init(){const e=this.editor;e.model.schema.register("listItem",{inheritAllFrom:"$block",allowAttributes:["listType","listIndent"]});const t=e.data,i=e.editing;var n;e.model.document.registerPostFixer((t=>function(e,t){const i=e.document.differ.getChanges(),n=new Map;let o=!1;for(const n of i)if("insert"==n.type&&"listItem"==n.name)s(n.position);else if("insert"==n.type&&"listItem"!=n.name){if("$text"!=n.name){const i=n.position.nodeAfter;i.hasAttribute("listIndent")&&(t.removeAttribute("listIndent",i),o=!0),i.hasAttribute("listType")&&(t.removeAttribute("listType",i),o=!0),i.hasAttribute("listStyle")&&(t.removeAttribute("listStyle",i),o=!0),i.hasAttribute("listReversed")&&(t.removeAttribute("listReversed",i),o=!0),i.hasAttribute("listStart")&&(t.removeAttribute("listStart",i),o=!0);for(const t of Array.from(e.createRangeIn(i)).filter((e=>e.item.is("element","listItem"))))s(t.previousPosition)}s(n.position.getShiftedBy(n.length))}else"remove"==n.type&&"listItem"==n.name?s(n.position):("attribute"==n.type&&"listIndent"==n.attributeKey||"attribute"==n.type&&"listType"==n.attributeKey)&&s(n.range.start);for(const e of n.values())r(e),l(e);return o;function s(e){const t=e.nodeBefore;if(t&&t.is("element","listItem")){let e=t;if(n.has(e))return;for(let t=e.previousSibling;t&&t.is("element","listItem");t=e.previousSibling)if(e=t,n.has(e))return;n.set(t,e)}else{const t=e.nodeAfter;t&&t.is("element","listItem")&&n.set(t,t)}}function r(e){let i=0,n=null;for(;e&&e.is("element","listItem");){const s=e.getAttribute("listIndent");if(s>i){let r;null===n?(n=s-i,r=i):(n>s&&(n=s),r=s-n),t.setAttribute("listIndent",r,e),o=!0}else n=null,i=e.getAttribute("listIndent")+1;e=e.nextSibling}}function l(e){let i=[],n=null;for(;e&&e.is("element","listItem");){const s=e.getAttribute("listIndent");if(n&&n.getAttribute("listIndent")>s&&(i=i.slice(0,s+1)),0!=s)if(i[s]){const n=i[s];e.getAttribute("listType")!=n&&(t.setAttribute("listType",n,e),o=!0)}else i[s]=e.getAttribute("listType");n=e,e=e.nextSibling}}}(e.model,t))),i.mapper.registerViewToModelLength("li",W),t.mapper.registerViewToModelLength("li",W),i.mapper.on("modelToViewPosition",q(i.view)),i.mapper.on("viewToModelPosition",(n=e.model,(e,t)=>{const i=t.viewPosition,o=i.parent,s=t.mapper;if("ul"==o.name||"ol"==o.name){if(i.isAtEnd){const e=s.toModelElement(i.nodeBefore),o=s.getModelLength(i.nodeBefore);t.modelPosition=n.createPositionBefore(e).getShiftedBy(o)}else{const e=s.toModelElement(i.nodeAfter);t.modelPosition=n.createPositionBefore(e)}e.stop()}else if("li"==o.name&&i.nodeBefore&&("ul"==i.nodeBefore.name||"ol"==i.nodeBefore.name)){const r=s.toModelElement(o);let l=1,a=i.nodeBefore;for(;a&&Q(a);)l+=s.getModelLength(a),a=a.previousSibling;t.modelPosition=n.createPositionBefore(r).getShiftedBy(l),e.stop()}})),t.mapper.on("modelToViewPosition",q(i.view)),e.conversion.for("editingDowncast").add((t=>{t.on("insert",$,{priority:"high"}),t.on("insert:listItem",N(e.model)),t.on("attribute:listType:listItem",K,{priority:"high"}),t.on("attribute:listType:listItem",O,{priority:"low"}),t.on("attribute:listIndent:listItem",function(e){return(t,i,n)=>{if(!n.consumable.consume(i.item,"attribute:listIndent"))return;const o=n.mapper.toViewElement(i.item),s=n.writer;s.breakContainer(s.createPositionBefore(o)),s.breakContainer(s.createPositionAfter(o));const r=o.parent,l=r.previousSibling,a=s.createRangeOn(r);s.remove(a),l&&l.nextSibling&&L(s,l,l.nextSibling),U(i.attributeOldValue+1,i.range.start,a.start,o,n,e),B(i.item,o,n,e);for(const e of i.item.getChildren())n.consumable.consume(e,"insert")}}(e.model)),t.on("remove:listItem",function(e){return(t,i,n)=>{const o=n.mapper.toViewPosition(i.position).getLastMatchingPosition((e=>!e.item.is("element","li"))).nodeAfter,s=n.writer;s.breakContainer(s.createPositionBefore(o)),s.breakContainer(s.createPositionAfter(o));const r=o.parent,l=r.previousSibling,a=s.createRangeOn(r),c=s.remove(a);l&&l.nextSibling&&L(s,l,l.nextSibling),U(n.mapper.toModelElement(o).getAttribute("listIndent")+1,i.position,a.start,o,n,e);for(const e of s.createRangeIn(c).getItems())n.mapper.unbindViewElement(e);t.stop()}}(e.model)),t.on("remove",j,{priority:"low"})})),e.conversion.for("dataDowncast").add((t=>{t.on("insert",$,{priority:"high"}),t.on("insert:listItem",N(e.model))})),e.conversion.for("upcast").add((e=>{e.on("element:ul",F,{priority:"high"}),e.on("element:ol",F,{priority:"high"}),e.on("element:li",D,{priority:"high"}),e.on("element:li",M)})),e.model.on("insertContent",z,{priority:"high"}),e.commands.add("numberedList",new C(e,"numbered")),e.commands.add("bulletedList",new C(e,"bulleted")),e.commands.add("indentList",new E(e,"forward")),e.commands.add("outdentList",new E(e,"backward"));const o=i.view.document;this.listenTo(o,"enter",((e,t)=>{const i=this.editor.model.document,n=i.selection.getLastPosition().parent;i.selection.isCollapsed&&"listItem"==n.name&&n.isEmpty&&(this.editor.execute("outdentList"),t.preventDefault(),e.stop())}),{context:"li"}),this.listenTo(o,"delete",((e,t)=>{if("backward"!==t.direction)return;const i=this.editor.model.document.selection;if(!i.isCollapsed)return;const n=i.getFirstPosition();if(!n.isAtStart)return;const o=n.parent;if("listItem"!==o.name)return;o.previousSibling&&"listItem"===o.previousSibling.name||(this.editor.execute("outdentList"),t.preventDefault(),e.stop())}),{context:"li"}),this.listenTo(e.editing.view.document,"tab",((t,i)=>{const n=i.shiftKey?"outdentList":"indentList";this.editor.commands.get(n).isEnabled&&(e.execute(n),i.stopPropagation(),i.preventDefault(),t.stop())}),{context:"li"})}afterInit(){const e=this.editor.commands,t=e.get("indent"),i=e.get("outdent");t&&t.registerChildCommand(e.get("indentList")),i&&i.registerChildCommand(e.get("outdentList"))}}function W(e){let t=1;for(const i of e.getChildren())if("ul"==i.name||"ol"==i.name)for(const e of i.getChildren())t+=W(e);return t}class Y extends e.Plugin{static get pluginName(){return"ListUI"}init(){const e=this.editor.t;R(this.editor,"numberedList",e("Numbered List"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM3.5 3v5H2V3.7H1v-1h2.5V3zM.343 17.857l2.59-3.257H2.92a.6.6 0 1 0-1.04 0H.302a2 2 0 1 1 3.995 0h-.001c-.048.405-.16.734-.333.988-.175.254-.59.692-1.244 1.312H4.3v1h-4l.043-.043zM7 14.75a.75.75 0 0 1 .75-.75h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75z"/></svg>'),R(this.editor,"bulletedList",e("Bulleted List"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0C1 4.784 1.777 4 2.75 4c.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75C1.784 7.5 1 6.723 1 5.75zm6 9c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0c0-.966.777-1.75 1.75-1.75.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75-.966 0-1.75-.777-1.75-1.75z"/></svg>')}}class G extends e.Plugin{static get requires(){return[J,Y]}static get pluginName(){return"List"}}const X=class{constructor(e){this.editor=e,this.elementId=this.editor.sourceElement.dataset.ckeditor5PremiumElementId}processCollaborationCommandDisable(e){if(!this.isCollaborationDisabled())return!1;const t=this.editor.commands._commands.get(e);return void 0===t||t.forceDisabled("premium-features-module"),!0}processRevisionDisable(){return!!this.isCollaborationDisabled()&&(this.editor.plugins.has("RevisionTracker")&&(this.editor.plugins.get("RevisionTracker").isEnabled=!1),!0)}isCollaborationDisabled(){return void 0!==drupalSettings.ckeditor5Premium&&void 0!==drupalSettings.ckeditor5Premium.disableCollaboration&&!0===drupalSettings.ckeditor5Premium.disableCollaboration}getEditorParentContainer(e){let t=document.getElementById(e);for(;t&&void 0!==t&&void 0!==t.classList&&!t.classList.contains("ck-editor-sidebar-wrapper");)t=t.parentElement;return t&&void 0!==t?t.parentElement:null}getSourceDataSelector(e){return{trackChanges:".track-changes",comments:".comments",revisionHistory:".revision-history",revisionHistoryContainer:".revision-history-container"}[e]+"-data"+`[data-ckeditor5-premium-element-id="${this.elementId}"]`}};const Z={CommentsAdapter:class{constructor(e){this.editor=e,this.storage=new X(e),this.editor.plugins._availablePlugins.set("Autoformat",c),this.editor.plugins._availablePlugins.set("Bold",b),this.editor.plugins._availablePlugins.set("Italic",w),this.editor.plugins._availablePlugins.set("List",G);const t=Array.from(this.editor.plugins._availablePlugins.values()).filter((e=>["Bold","Italic","List","Autoformat"].includes(e.pluginName)));this.editor.config._config.comments.editorConfig.extraPlugins.push(...t)}static get pluginName(){return"CommentsAdapter"}static get requires(){return["CommentsRepository"]}init(){if(this.storage.processCollaborationCommandDisable("addCommentThread"))return;if(!this.editor.plugins.has("CommentsRepository"))return;const e=this.editor.plugins.get("CommentsRepository"),t=document.querySelector(this.storage.getSourceDataSelector("comments"));if(!t||""==t.value)return;const i=JSON.parse(t.value);for(const t of i)e.addCommentThread(t);this.editor.model.document.on("comments:change:data",(()=>{this.updateStorage(e,t)})),this.editor.model.document.on("trackchanges:change:data",(()=>{this.updateStorage(e,t)}));const n=["addComment","change","removeComment","removeCommentThread","updateComment"];for(const t of n)e.on(t,(()=>{this.editor.model.document.fire("comments:change:data")}));this.editor.sourceElement.closest("form").addEventListener("submit",(()=>{this.updateStorage(e,t)}))}updateStorage(e,t){t.value=JSON.stringify(e.getCommentThreads({skipNotAttached:!0,skipEmpty:!0,toJSON:!0}))}}}})(),n=n.default})()));;
